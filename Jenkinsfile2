pipeline{
	
	agent {label 'vagrant-worker'}
	tools {
  			terraform 'terraform'
		}
	stages{
		stage('removing previous clone if exists'){
		steps{
		    script{
		      def dirExists  = fileExists '$WORKSPACE/terraform-docker-nginx/'
			   if (dirExists){
				 sh 'rm -rf $WORKSPACE/terraform-docker-nginx/'	    
			       }
	   	     }
		   }		
	  	 }
		 
		stage('Git Checkout Repo'){ 
			steps{
				
				git branch: 'main', credentialsId: 'gitHub', url: 'https://github.com/abdallauno1/terraform-docker-nginx'
				}
			  
			}
			stage('Terraform Init'){
				steps{
					sh 'terraform init'
				}
			}
			stage('Terraform Apply'){
				steps{
					sh 'terraform apply --auto-approve'
				}
			}


		}
	}
